CREATE TABLE CUSTOMER
(
	CUST_ID VARCHAR(10),
	CUST_NAME VARCHAR(20),
	CUST_CITY VARCHAR(20),
	CONSTRAINT CUST_PK PRIMARY KEY(CUST_ID)
);

CREATE TABLE ITEM
(
	ITEM_ID VARCHAR(10),
	ITEM_NAME VARCHAR(20),
	UNIT_PRICE NUMBER(10),
	CONSTRAINT ITEM_PK PRIMARY KEY(ITEM_ID)
);



CREATE TABLE PURCHASE 
(
	ORDER_NO VARCHAR(10),
	CUST_ID VARCHAR(10),
	ITEM_ID VARCHAR(10),
	DOP DATE,
	CONSTRAINT PURC_PK PRIMARY KEY(ORDER_NO),
	CONSTRAINT PURC_FK1 FOREIGN KEY(CUST_ID) REFERENCES CUSTOMER,
	CONSTRAINT PURC_FK2 FOREIGN KEY(ITEM_ID) REFERENCES ITEM
);



INSERT INTO CUSTOMER 
VALUES ('CUST_001','JIMUT BAHAN PAL','LA');


INSERT INTO CUSTOMER
VALUES ('CUST_002','SHRESHTHA SARKAR','KOLKATA');

INSERT INTO CUSTOMER
VALUES ('CUST_003','AKASH MANNA','NY');

INSERT INTO CUSTOMER
VALUES ('CUST_004','BIKASH PANDEY','SAN FRANSISCO');





INSERT INTO ITEM
VALUES ('ITEM_001','HDD',4500);


INSERT INTO ITEM
VALUES ('ITEM_002','PD',450);

INSERT INTO ITEM
VALUES ('ITEM_003','MOUSE',750);

INSERT INTO ITEM
VALUES ('ITEM_004','CALCULATOR',500);




INSERT INTO PURCHASE
VALUES ('OR_001','CUST_001','ITEM_001','05/07/2016');


INSERT INTO PURCHASE
VALUES ('OR_002','CUST_002','ITEM_002','07/07/2017');

INSERT INTO PURCHASE
VALUES ('OR_003','CUST_003','ITEM_003','08/06/2017');

INSERT INTO PURCHASE
VALUES ('OR_004','CUST_004','ITEM_004','07/08/2015');

INSERT INTO PURCHASE
VALUES ('OR_005','CUST_003','ITEM_001','08/07/2016');

INSERT INTO PURCHASE
VALUES ('OR_006','CUST_004','ITEM_001','07/07/2016');





-- TO FIND OUT THE DETAILS OF ALL THE CUSTOMERS WHO HAVE BROUGHT THE MAXIMUM PRICE ARTICLE


-- TO GET THE LARGEST VALUED PRODUCT

SELECT MAX(UNIT_PRICE)
FROM ITEM;

-- TO GET THE MAXIMUM VALUED PROD ITEM ID

SELECT ITEM_ID 
FROM ITEM WHERE UNIT_PRICE=(SELECT MAX(UNIT_PRICE)
			FROM ITEM);
	
			
SELECT *
FROM PURCHASE
WHERE ITEM_ID = (SELECT ITEM_ID FROM ITEM WHERE UNIT_PRICE = (SELECT MAX(UNIT_PRICE) FROM ITEM));

SELECT CUST_ID
FROM PURCHASE
WHERE ITEM_ID = 'ITEM_001';

-- 2015 R MAL

SELECT * 
FROM PURCHASE
WHERE TO_CHAR(DOP,'YYYY')=2015;



-- TO GROUP THE CUSTOMERS ACCORDING TO THE CITY


SELECT CUST_CITY,COUNT(CUST_NAME)
FROM CUSTOMER
GROUP BY CUST_CITY;


-- DETAILS OF THE HIGHEST SOLD ITEM


SELECT MAX(COUNT(ITEM_ID))
FROM PURCHASE
GROUP BY ITEM_ID;



SELECT ITEM_ID,COUNT(ITEM_ID) AS ITEM
FROM PURCHASE
GROUP BY ITEM_ID;


SELECT MAX(ITEM) AS MAXIMUM
FROM (SELECT ITEM_ID,COUNT(ITEM_ID) AS ITEM
	FROM PURCHASE
	GROUP BY ITEM_ID);

---- ?



SELECT ITEM_ID
FROM (SELECT MAX(ITEM) AS ITEM
		FROM(SELECT ITEM_ID,COUNT(ITEM_ID) AS ITEM
			FROM PURCHASE
			GROUP BY ITEM_ID))
WHERE MAX(ITEM_ID)
	FROM PURCHASE
	GROUP BY ITEM_ID;



SELECT ITEM_ID 
FROM (SELECT ITEM_ID,COUNT(ITEM_ID) AS ITEM
 	FROM PURCHASE
  	GROUP BY ITEM_ID)
WHERE ITEM=(SELECT ITEM_ID,COUNT(ITEM_ID) AS ITEM
		FROM PURCHASE
		GROUP BY ITEM_ID);






SELECT ITEM_ID
FROM PURCHASE
WHERE ITEM_ID=(
SELECT ITEM_ID,MAX(ITEM_ID) FROM PURCHASE GROUP BY(ITEM_ID));

-- this QUERY RUNS TRUE
-- NEED TO FIGURE OUT HOW THIS SUBQUERY WORKS !



SELECT ITEM_ID 
FROM ITEM 
WHERE ITEM_ID 
IN (SELECT ITEM_ID 
	FROM PURCHASE 
	GROUP BY ITEM_ID 
	HAVING COUNT(*)=(SELECT MAX(COUNT(ITEM_ID)) 
			FROM PURCHASE 
			GROUP BY ITEM_ID));







SELECT * FROM CUSTOMER
WHERE CUST_NAME NOT LIKE 'S%';


SELECT ITEM_ID 
FROM PURCHASE 
WHERE CUST_ID IN(SELECT CUST_ID FROM CUSTOMER
		WHERE CUST_NAME 
		NOT LIKE 'S%');


SELECT * 
FROM ITEM
WHERE ITEM_ID IN(SELECT ITEM_ID
		FROM PURCHASE
		WHERE CUST_ID IN(SELECT CUST_ID FROM CUSTOMER
                	WHERE CUST_NAME 
                	NOT LIKE 'S%'));











